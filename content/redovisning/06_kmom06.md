---
---
Redovisning kmom06
=========================

Kmom06, har handlat mycket om att hantera text från en databas på websidor och hur man bygger ett content management system. Själva textfiltreringen som var det vi skulle börja med tycker jag gick ganska enkelt att bygga. Uppgiften kändes lite oklar på om användaren själv skulle kunna bestämma order på filtren eller inte. Jag byggde därför två funktioner i filterklassen, en där man själva kan bestämma ordning på filtren man lägger in och en där ordningen redan är bestämd. Den med bestämd ordning är den jag har som standard i övriga delar av kursmomentet. Det är intressant att se vilken betydelse ordningen har, t.ex. om man använde htmlentities föra strip-tags, eller för den delen markdown före strip_tags så blir resultatet mycket annorlunda än om man gör tvärtom.

Nästa uppgift var att visa innehåll från databasen som websidor. Jag har här valt att använda mig av två controller-klasser en för att visa innehåll och en för att administrera innehåll. Dels får jag mindre klasser på så sätt dels så blir det enklare att se vilken del som hör till vad och det är mycket troligt att man i ett senare skede kommer att vilja dela upp dessa två delar i olika säkerhetsnivåer. Jag har lagt till en execption-klass som används för att skicka med meddelanden till en 404-sida. Jag använder mig också av min text-filter klass som ligger i ett annat namespace, den används dock bara vid renderingen av sidor och kalls på i vyn. Annars har jag bara tre klasser, en för att visa pages, en för att visa blog-poster och en för att administrera pages och poster. Jag tycker att det på så sätt blir ganska tydligt var man kan hitta de olika delarna av koden. Klasserna har inget inbördes beroende annat än att Controllern utnyttjar dem, alla klasser använder också exception-klassen vid fel.

Koden jag skrev i det här momentet känner jag att det finns förbättringsmöjligheter för. Funktionen för att felsöka om en path eller slug är en dubblett kan antagligen både lyftas ut som en egen metod och göras snyggare, kanske med sql-commando för att se om man kan hitta slug/path i databasen istället för att som nu plocka ut alla slugs eller pather och sedan jämföra mot det som är skrivet i formuläret. Jag tror också att det skulle vara bra att kunna flytta själva db->connect delarna från controllerna till klasserna, kanske lägga som en construct. Jag testade en del med att få till det i början av uppgiften men fick inte riktigt ramverket att samarbeta med mig. Admin-klassen har blivit ganska stor och kan komma att behöva delas upp om man skall lägga till fler funktioner. Jag är väldigt nöjd med min textfiltreringsklass, där det finns en standard metod där ordningen på filtrerna är bestämd och en metod där användaren själv kan bestämma ordningen. Båda dessa metoder klarar också av att få input om vilka filter som skall användas antingen som en kommaseparerad sträng eller som en array. Det gör den klassen mycket flexibel och jag ser att den kan användas för andra implementationer också. Jag är också nöjd att jag fått till att om man använder en redan existerande path eller slug så får man ett felmeddelande men ändringarna gjort försvinner inte (formuläret sparas i sessionen tills man kan få en godkänd db-inmatning).

Vad jag lärde mig i det här momentet var nog främst att verkligen kontrollera hur resultatet från databasen ser ut i den variabel som får resultatet. Jag hade stora problem med att jämföra resultatet från databasen med inputen från ett formulär efter databasens resultat kom som en två-nivås array där första nivån var ett objekt. Det är ganska enkelt att åtgärda med en kort foreach-sats men det tog ett tag för mig att lista ut det.
